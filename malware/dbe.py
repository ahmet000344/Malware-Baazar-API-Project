from flask import Flask
from celery import Celery
from flask_sqlalchemy import SQLAlchemy
import requests
appr = Flask(__name__)
appr.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////Users/Monster/Desktop/malware/malware.db'
db = SQLAlchemy(appr)


apps = Celery(broker="redis://localhost:6379/0")
@apps.task
def arka():
    a = requests.get("https://bazaar.abuse.ch/export/txt/md5/recent/").text
    with open("test.txt",'w') as fl:
        fl.write(a)

    with open("test.txt",'r') as fl:
        for i in fl.read().splitlines():
            if len(i) == 32:
                med5 = i
                newTodo = malware(med5 = med5)
                db.session.add(newTodo)
                db.session.commit()

class malware(db.Model):
    id = db.Column(db.Integer,primary_key=True)
    med5 = db.Column(db.String(80),unique=True) 