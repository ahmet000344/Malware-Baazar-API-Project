from dbe import arka
from flask import Flask,render_template,request,redirect,url_for
from flask_sqlalchemy import SQLAlchemy
from flask_restful import Resource, Api
from flask_marshmallow import Marshmallow
app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////Users/Monster/Desktop/malware/malware.db'
db = SQLAlchemy(app)
api = Api(app)
ma = Marshmallow(app)

class PostSchema(ma.Schema):
    class Meta:
        fields = ("med5", "id")
        model = "post"

post_schema = PostSchema()
posts_schema = PostSchema(many=True)

class PostListResource(Resource):
    def get(self):
        posts = malware.query.all()
        return posts_schema.dump(posts)

api.add_resource(PostListResource, '/api/v1/malware')
class PostResource(Resource):
    def get(self, post_id):
        post = malware.query.get_or_404(post_id)
        return post_schema.dump(post)
api.add_resource(PostResource, '/api/v1/malware/<int:post_id>')
@app.route("/")
def index():
    todos = malware.query.all()
    return render_template("index.html")

@app.route("/api/v1/malware", methods = ["POST"])
def altyapi():
    arka.delay()
    return render_template("index.html")

@app.route("/api/v1/malware/delete/<string:id>",methods = ["GET"])
def sil(id):
    delete = malware.query.filter_by(id=id).first()
    db.session.delete(todo)
    db.session.commit()
    return redirect(url_for("index"))


class malware(db.Model):
    id = db.Column(db.Integer,primary_key=True)
    med5 = db.Column(db.String(80),unique=True) 

if __name__ == "__main__":
    app.run(debug = True)